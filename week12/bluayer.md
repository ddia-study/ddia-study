# Chpater 10. Batch Processing

- 서비스(온라인 시스템)
- 일괄 처리 시스템(오프라인 시스템) : 처리량이 대표적인 지표
- 스트림 처리 시스템 : near-real-time processing / nearline processing

## 유닉스 도구로 일괄 처리하기

### 단순 로그 분석

실제로 많은 데이터 분석이 수 분 내에 awk, sed, grep, sort, uniq, xargs의 조합으로 결과를 얻을 수 있고 놀라울 정도로 잘 수행된다.

### 정렬 대 인메모리 집계

- URL 해시 테이블을 메모리에 유지
- 유닉스 연쇄 명령

중소 규모의 웹사이트 대부분은 고유 URL과 해당 URL 카운트를 대략 1GB 메모리에 담을 수 있다.

반면 허용 메모리보다 작업 세트가 크다면 정렬 접근법을 사용하는 것이 좋다.

먼저 데이터 청크를 메모리에 정렬하고 청크를 세그먼트 파일로 디스크에 저장한다.

그 다음 각각 정렬된 세그먼트 파일 여러 개를 한 개의 큰 정렬 파일로 병합한다.

### 유닉스 철학

**유닉스 파이프** : 다른 방법으로 데이터 처리가 필요할 때 정원 호스와 같이 여러 다른 프로그램을 연결하는 방법이 필요하다. 이것은 I/O 방식이기도 하다.

### 동일 인터페이스

특정 프로그램이 다른 어떤 프로그램과도 연결 가능하려면 프로그램 모두가 같은 입출력 인터페이스를 사용해야 한다는 의미다.

유닉스에서 인터페이스는 파일이다. 파일은 단지 순서대로 정렬된 바이트의 연속이다.

### 로직의 연결과 분리

파이프는 한 프로세스의 stdout을 다른 프로세스의 stdin과 연결한다. 이떄 중간 데이터를 디스크에 쓰지 않고 작은 인메모리 버퍼를 사용해 프로세스 간 데이터를 전송한다.

### 투명성과 실험

- 입력 파일은 일반적으로 불변
- 파이프라인을 중단하고 출력을 파이프를 통해 less로 보내 원하는 형태의 출력이 나오는지 확인 가능
- 특정 파이프라인의 출력을 파일에 쓰고 그 파일을 다음 단계의 입력으로 사용할 수 있다.

유닉스 도구를 사용하는 데 가장 큰 제약은 단일 장비에서만 실행된다는 점이다.

**바로 이 점이 하둡 같은 도구가 필요한 이유다.**

## 맵리듀스와 분산 파일 시스템

맵리듀스는 유닉스 도구와 비슷한 면이 있지만 **수천 대의 장비로** 분산해서 실행ㅎ이 가능하다.

맵리듀스 작업은 분산 파일 시스템 상의 파일을 입력과 출력으로 사용한다.

HDFS = 비공유 원칙

NAS, SAN에서 사용하는 공유 디스크와는 반대

NameNode라는 중앙 서버는 특정 파일 블록이 어떤 장비에 저장됐는지 추적한다.

장비가 죽거나 디스크가 실패하는 경우를 대비하기 위해 파일 블록은 여러 장비에 복제된다. (단순 복제 혹은 삭제 코딩)

RAID랑 비슷하지만 파일의 접근과 복제가 특별한 하드웨어 장치 없이 평범한 데이터 센터 네트워크 상에서 이뤄진다는 점이다.

### 맵리듀스 작업 실행하기

1. 입력 파일을 읽는다. 레코드로 쪼갠다.
2. 각 입력 레코드마다 매퍼 함수를 호출해 키와 값을 추출한다.***(Map)***
3. 키를 기준으로 키-값 쌍을 모두 정렬한다.
4. 정렬된 키-값 쌍 전체를 대상으로 리듀스 함수를 호출한다. ***(Reduce)***

2, 4단계는 사용자가 직접 작성해야 한다.

- **Mapper** : 매퍼는 모든 입력 레코드마다 한 번씩만 호출하며, 레코드로부터 키와 값을 추출하는 작업이다. 각 레코드는 독립 처리 된다.
- **Reducer** : 매퍼가 생산한 키-값 쌍을 받아 같은 키를 가진 레코드를 모으고 출력 레코드를 생산한다. 예시로 동일 URL의 출현 횟수가 있다.



